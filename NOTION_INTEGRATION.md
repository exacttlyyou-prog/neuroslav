# Расширенная интеграция с Notion

## Реализованные возможности

### 1. Автоматическое создание страниц встреч
- ✅ При обработке встречи автоматически создается страница в Notion
- ✅ Структурированный контент: саммари, участники, action items
- ✅ Если указан `notion_page_id`, контент добавляется на существующую страницу
- ✅ Если не указан, создается новая страница в родительской директории

### 2. Глоссарий терминов
- ✅ Новый метод `get_glossary_from_db()` для загрузки терминов
- ✅ Глоссарий синхронизируется в `ContextLoader`
- ✅ Можно использовать для обогащения контекста при анализе

### 3. Поиск в Notion
- ✅ Новый метод `search_in_notion()` для поиска по базам
- ✅ Поиск по всем доступным базам (People, Projects, Glossary)
- ✅ API endpoint `/api/notion/search?q=query`

### 4. Работа с AI-Context страницами
- ✅ Новый метод `get_ai_context_pages()` для получения дочерних страниц
- ✅ Извлечение контента из страниц AI-Context
- ✅ API endpoint `/api/notion/context/pages`

### 5. Расширенная синхронизация
- ✅ Автоматическая синхронизация глоссария при загрузке контекста
- ✅ Улучшенная обработка ошибок (graceful fallback)

## Новые API endpoints

### GET /api/notion/context/pages
Получает список страниц из AI-Context.

**Query параметры:**
- `parent_page_id` (опционально) - ID родительской страницы

**Ответ:**
```json
{
  "pages": [
    {
      "id": "page_id",
      "title": "Название страницы",
      "content": "Контент страницы"
    }
  ]
}
```

### GET /api/notion/search
Ищет в базах данных Notion.

**Query параметры:**
- `q` (обязательно) - поисковый запрос
- `database_id` (опционально) - ID конкретной базы

**Ответ:**
```json
{
  "results": [...]
}
```

### GET /api/notion/glossary
Получает глоссарий терминов.

**Ответ:**
```json
{
  "glossary": {
    "термин": "определение",
    ...
  }
}
```

## Использование в workflows

### Meeting Workflow
Теперь автоматически создает страницу встречи в Notion:
- Если передан `notion_page_id` → добавляет контент на страницу
- Если не передан → создает новую страницу с полной структурой

### Context Loader
Синхронизирует:
- People (контакты)
- Projects (проекты)
- Glossary (глоссарий)

## Дополнительные возможности использования Notion

### 1. Хранилище истории
- Все обработанные встречи сохраняются в Notion
- Можно создать базу данных "История встреч" для структурированного хранения
- Связи с проектами и участниками через relations

### 2. Календарь дедлайнов
- Создание страниц задач с датами
- Интеграция с календарем Notion
- Автоматические напоминания через Notion reminders

### 3. База знаний проектов
- Автоматическое обновление страниц проектов после встреч
- Связывание встреч с проектами через relations
- История изменений проекта

### 4. Глоссарий для контекста
- Использование глоссария для обогащения промптов
- Автоматическое объяснение терминов в саммари
- Связь терминов с проектами и встречами

### 5. AI-Context как источник знаний
- Чтение контента из AI-Context страниц
- Использование для RAG (дополнение к ChromaDB)
- Синхронизация знаний между Notion и векторной БД

## Настройка

Добавьте в `.env`:
```bash
# Notion базы данных
NOTION_TOKEN=secret_...
NOTION_PEOPLE_DB_ID=...
NOTION_PROJECTS_DB_ID=...
NOTION_GLOSSARY_DB_ID=...  # Новое
NOTION_MEETING_PAGE_ID=...  # Родительская страница для встреч
```

## Структура базы AI-Context

Рекомендуемая структура в Notion:
```
AI-Context (страница)
├── Встречи (дочерние страницы или база данных)
├── Задачи (дочерние страницы или база данных)
├── Контекст проектов (дочерние страницы)
└── Другие страницы с контекстом
```

## Следующие шаги

1. Настроить базы данных в Notion
2. Протестировать создание страниц встреч
3. Использовать глоссарий для обогащения контекста
4. Интегрировать AI-Context страницы в RAG
