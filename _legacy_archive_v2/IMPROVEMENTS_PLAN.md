# План улучшений: Чат-интерфейс с агентами и автоматизация

## Проблемы

1. **Дизайн фронта** - не автоматизирован, требует ручного выбора типа действия
2. **AI саммари не подгружаются** - проблема с отображением результатов встреч
3. **Архитектура** - отдельные workflows вместо единого чата с агентами
4. **RAG** - работает, но не интегрирован в общий поток

## Решение: Чат-интерфейс с агентами

### Концепция

Единый чат, где пользователь просто пишет, а система сама решает:
- **Задача** → TaskAgent
- **Пожелание/идея** → KnowledgeAgent  
- **Отложенное сообщение** → MessageAgent
- **Репорт встречи** → MeetingAgent (с кнопкой "Сделать репорт")
- **Вопрос** → RAGAgent (поиск по базе знаний)

### Архитектура

```
User Input (чат)
    ↓
AgentRouter (LLM классификация)
    ↓
┌───┴───┬──────┬──────────┬────────┬──────┐
│       │      │          │        │      │
Task  Meeting Message Knowledge  RAG  Default
Agent  Agent  Agent     Agent    Agent Agent
    ↓      ↓      ↓         ↓       ↓      ↓
Workflows → RAG → Notion → Telegram → БД
```

## План реализации

### Фаза 1: AgentRouter и классификация (Backend)

**Файлы:**
- `apps/api/app/services/agent_router.py` (новый)
- `apps/api/app/services/agents/task_agent.py` (новый)
- `apps/api/app/services/agents/meeting_agent.py` (новый)
- `apps/api/app/services/agents/knowledge_agent.py` (новый)
- `apps/api/app/services/agents/rag_agent.py` (новый)
- `apps/api/app/routers/chat.py` (новый)

**Функционал:**
- Классификация через LLM (Ollama)
- Маршрутизация к нужному агенту
- Каждый агент использует RAG для контекста
- Автоматическое сохранение результатов

### Фаза 2: Чат-интерфейс (Frontend)

**Файлы:**
- `apps/web/components/chat/ChatInterface.tsx` (новый)
- `apps/web/components/chat/MessageList.tsx` (новый)
- `apps/web/components/chat/QuickActions.tsx` (новый)
- `apps/web/app/(tabs)/chat/page.tsx` (новый)
- `apps/web/app/api/chat/route.ts` (новый)

**Дизайн:**
- Чистый чат-интерфейс (как ChatGPT)
- История сообщений с индикаторами агентов
- Быстрые действия в боковой панели
- Автоматическое определение типа сообщения
- Показ статуса обработки в реальном времени

### Фаза 3: Исправление проблем

**Проблема: AI саммари не подгружаются**
- Проверить `MeetingResults` компонент
- Исправить отображение markdown/HTML
- Добавить fallback для пустых саммари

**RAG интеграция:**
- Каждый агент использует RAG перед обработкой
- Автоматический поиск похожих встреч/документов
- Сохранение всех результатов в RAG

### Фаза 4: Улучшение дизайна

**Принципы:**
- Минимализм (как Linear, Notion)
- Автоматизация (меньше кликов)
- Прозрачность (видно что происходит)
- Быстрота (индикаторы загрузки)

**Компоненты:**
- Обновить цветовую схему
- Улучшить типографику
- Добавить микро-интеракции
- Адаптивность для мобильных

## Технические детали

### AgentRouter

```python
class AgentRouter:
    async def route(self, user_input: str) -> AgentType:
        # LLM классификация
        classification = await self.ollama.classify_intent(user_input)
        return classification.agent_type
```

### Агенты

Каждый агент:
1. Получает контекст из RAG
2. Обрабатывает через свой workflow
3. Сохраняет в БД/Notion
4. Возвращает результат в чат

### Чат-интерфейс

- WebSocket или Server-Sent Events для real-time
- История в localStorage
- Поиск по истории
- Экспорт разговоров

## Приоритеты

1. **Высокий**: Исправить подгрузку саммари
2. **Высокий**: Создать AgentRouter
3. **Средний**: Чат-интерфейс
4. **Средний**: Улучшение дизайна
5. **Низкий**: Дополнительные фичи
